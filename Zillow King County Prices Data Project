# About the Data https://www.kaggle.com/harlfoxem/housesalesprediction/data
# Load the Libraries
library(corrplot)
library(ggplot2)
library(sqldf)

# Read csv file into a Data Frame
df <- read.csv("C:\\Users\\prasa\\Desktop\\Data\\zillow_data\\kc_house_data.csv",header = TRUE) # Importing the dataset into R Studio
str(df)
dim(df)
colnames(df)
head(df,2)

#Check for missing values
missing <- is.na(df)
missing
sum(missing)
colSums(missing)

# Find Summaries of numerical variables
summary(df$price)  # response 
#summary(df$price)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#75000  321950  450000  540182  645000 7700000 
summary(df$bedrooms)
#summary(df$bedrooms)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.000   3.000   3.000   3.371   4.000  33.000 
summary(df$bathrooms)
#summary(df$bathrooms)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.000   1.750   2.250   2.115   2.500   8.000 
summary(df$sqft_living)
#summary(df$sqft_living)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#290    1427    1910    2080    2550   13540 
summary(df$sqft_lot)
#summary(df$sqft_lot)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#520    5040    7618   15107   10688 1651359 
summary(df$floors)
#summary(df$floors)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#1.000   1.000   1.500   1.494   2.000   3.500 
summary(df$waterfront)
#summary(df$waterfront)
#Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
#0.000000 0.000000 0.000000 0.007542 0.000000 1.000000 
summary(df$view)
#summary(df$view)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.0000  0.0000  0.0000  0.2343  0.0000  4.0000
summary(df$condition)
#summary(df$condition)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#1.000   3.000   3.000   3.409   4.000   5.000 
summary(df$grade)
#summary(df$grade)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#1.000   7.000   7.000   7.657   8.000  13.000 
summary(df$sqft_above)
#summary(df$sqft_above)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#290    1190    1560    1788    2210    9410
summary(df$sqft_basement)
#summary(df$sqft_basement)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.0     0.0     0.0   291.5   560.0  4820.0 
summary(df$yr_built)
#summary(df$yr_built)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#1900    1951    1975    1971    1997    2015
summary(df$sqft_living15)
#summary(df$sqft_living15)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#399    1490    1840    1987    2360    6210
summary(df$sqft_lot15)
#summary(df$sqft_lot15)
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#651    5100    7620   12768   10083  871200

# Don't need the id variable and the date variable , so will drop it for now
df[1:2] <- NULL # Drop date house was sold and ID. ID variable is of no use for us for the regrssion analysis
df

# Find correlation among all features and price

corr <- cor(df)
dim(corr)

# Correlation Plot of Different Features and Price
corrplot(corr,type = "full", method = "circle", main = "Correlation")

# Print the Correlation co-efficients

corr <- (round(corr,digits = 2))
corr
install.packages("xlsx")
library(xlsx)
write.xlsx(corr, "C:\\Users\\prasa\\Desktop\\RCode\\corr.xlsx")


# Features/ predictors/independent regressors/explanatory variables that are highly correlated with response/dependent
# variable price

# Correlation between price and sqft living is highest 0.7
# Correlation between price and grade is  0.67
# Correlation between price and sqft_above is 0.61
# Correlation between price and sqft_living15 is 0.59
# Correlation between price and number of bathrooms is 0.53

# Evaluating multi collinearity between predictor variables/ features
# sqft_living is correlated with sqft_above 0.88
# sqft_living is correlated with sqft_living15 0.76
# sqft_living is correlated with grade 0.76
# # sqft_living is correlated with bathrooms 0.75
# sqft_living is correlated with bedrooms 0.58



par(mfrow = c(3,3))
for (i in c(2:19)){
  plot(df[,i],df$price,main=names(df[i]),ylab = names(df$price),xlab = names(df[i]),col = 'steelblue')
}


# Taking a look at the categorical variables and drawing box plot of price against each categrical variable
par(mfrow=c(1,1))
for (i in c(2,3,6,7,8,9,10,15)){
  boxplot(df[,1]~df[,i],ylab= names(df[1]),xlab = names(df[i]),main=names(df[i]),col=c("orange","blue"))
}
     

# Interpreting The Box Plot
 # Bedrooms: Median prices across bedrooms do not have a lot of variation. There are bedroom extremes I can see
# that there are house/houses with 11 and 33 bedrooms and have lowere price than other bedroom houses which is weird
# Bathrooms: Median price increase as # bathrooms increase but there are categorical lows also
# Floors: Shows catrgorcial variation for median price
# Waterfrom: MEdian price is higher with a watefront
# view: The median price generally increases as the views increase
# There is some variability in price because of condition
# median price is increasing with grade
# some zip codes command higher prices

# bedroom extremes
# The box plot shows that bedrooms tend to have extreme values

par(mfrow = c(1,2))
hist(df$bedrooms, breaks = 30, xlab = "", col = "steelblue",main = "Bedrooms")
plot(density(df$bedrooms),xlab = "",col= "steelblue", main = "Bedrooms")

# Checking Bedroom Extremes

print(subset(df,df$bedrooms>10))

# 2 houses have extreme values. One house has 11 bedrooms while the other house has 33 bedrooms. The price looks
# astonishingly low.The 33 bedrooms house has 1.75 bathrooms which does not majke sense.There must be some data error. What is the average price of a house having 3 bedrooms?

bedroom3 <- subset(df,df$bedrooms ==3)
bedroom3
print(tapply(bedroom3$sqft_living, bedroom3$bedrooms, mean))

# The mean sqft_living for a 3 bedroom house is 1805.837. Instead of removing the data point, am going to update
look.for <- c(33)
df[df$bedrooms %in% look.for,]

#print(sqldf("select * from df where bedrooms = 33 "))

# The house which has 33 bedrooms has record number 15871

# Updating bedrooms of row 15871 to 3
df[15871,2] <- 3


# Bathrooms

par(mfrow = c(1,3))
hist(df$bathrooms, breaks = 20, xlab = "",col = "lightsteelblue", main = "Bathrooms")
plot(density(df$bathrooms), xlab="", col = "steelblue", main="Bathrooms")
scatter.smooth(df$bathrooms,df$price,col = "steelblue", xlab = "Bathrooms", ylab = "Price", main = "Bathrooms", lpars = list(col="red",lwd = 2))

# Distribution looks skewed
# Bedroom outliers?

print(sqldf("select max(bathrooms),avg(bathrooms) from df"))

# As per the bathrooms scatter plot, most of the houses have # bathrooms < = 8 

# Whats the proportion of houses that have bathroom greater than or equal to 6?

print(prop.table(table(df$bathrooms >= 6)))
# 99.92 % of houses have bathrooms less than 6 aka 0.0740 have bathrooms greater than = 6. Take the example of 
# the 8 bathroom houses. There are just 2 8 bathroom house, one with a very low price and the other with a 
# very high price. This is the reason why we observe high median price as # bathrooms increase


# Referring to the correlation matrix,excel file corr.xlsx lets start choosing the variables that I will use for building 
# the model

# Choosing following numeric variables for building the model:

sqft_living
bathrooms


print(sqldf("select * from df where bathrooms = 8"))
